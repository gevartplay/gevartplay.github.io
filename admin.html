<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | GevArtPlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: white; font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; position: relative; }
        h1 { font-family: 'Oswald', sans-serif; color: #5b51d8; letter-spacing: 2px; margin-top: 40px; }
        
        .back-btn { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #aaa; font-family: 'Oswald', sans-serif; font-size: 14px; border: 1px solid #333; padding: 10px 20px; border-radius: 30px; transition: 0.3s; background: rgba(255,255,255,0.05); }
        .back-btn:hover { color: white; border-color: #5b51d8; background: #5b51d8; }

        .box { background: #111; padding: 30px; border-radius: 10px; border: 1px solid #333; text-align: center; width: 100%; max-width: 500px; margin-bottom: 20px; }
        input, select { width: 90%; padding: 10px; margin-bottom: 20px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }
        
        button { background: #5b51d8; color: white; border: none; padding: 12px 30px; width: 100%; font-family: 'Oswald', sans-serif; font-size: 1.2rem; cursor: pointer; transition: 0.3s; border-radius: 5px; margin-bottom: 10px; }
        button:hover { background: #fff; color: #000; }
        
        /* –õ–æ–≥ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .log-container { text-align: left; margin-top: 15px; max-height: 200px; overflow-y: auto; background: #000; padding: 10px; border-radius: 5px; border: 1px solid #333; }
        .log-item { font-size: 12px; margin-bottom: 5px; border-bottom: 1px solid #222; padding-bottom: 2px; }
        .success { color: #00ff00; }
        .error { color: #ff4444; }

        .hidden { display: none; }
        .logout-link { color: #555; font-size: 12px; cursor: pointer; text-decoration: underline; margin-top: 20px; }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn">‚Üê –ù–ê –°–ê–ô–¢</a>

    <h1>–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h1>

    <div id="loginSection" class="box">
        <h3>–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø</h3>
        <input type="password" id="tokenInput" placeholder="ghp_...">
        <button onclick="saveTokenAndLogin()">–í–û–ô–¢–ò</button>
    </div>

    <div id="mainSection" class="hidden">
        
        <div class="box">
            <h3>üì∏ –ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</h3>
            <p style="font-size: 12px; color: #aaa;">–°–æ–≤–µ—Ç: –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –ø–æ 3-5 —Ñ–æ—Ç–æ –∑–∞ —Ä–∞–∑.</p>
            <input type="file" id="fileInput" accept="image/*" multiple>
            <button onclick="uploadImages()">–ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</button>
            
            <div id="uploadLog" class="log-container hidden"></div>
        </div>

        <div class="box" style="border-color: #5b51d8;">
            <h3>üé¨ –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ò–î–ï–û</h3>
            <input type="text" id="videoUrl" placeholder="https://youtu.be/...">
            <select id="videoCategory">
                <option value="events">EVENTS</option>
                <option value="fashion">FASHION</option>
                <option value="music">MUSIC</option>
            </select>
            <button onclick="addVideo()">–î–û–ë–ê–í–ò–¢–¨ –í–ò–î–ï–û</button>
            <div id="videoList" class="video-list"></div>
        </div>

        <p id="status"></p>
        <div class="logout-link" onclick="logout()">–í—ã–π—Ç–∏</div>
    </div>

    <script>
        const USERNAME = 'gevartplay'; 
        const REPO = 'gevartplay.github.io';
        const PHOTO_FOLDER = 'images';
        const VIDEO_FILE = 'videos.json'; 

        let userToken = '';
        let currentVideos = [];
        let videoFileSha = null; 

        document.addEventListener("DOMContentLoaded", () => {
            const savedToken = localStorage.getItem('github_token_gevartplay');
            if (savedToken) { userToken = savedToken; unlockAdmin(); }
        });

        function saveTokenAndLogin() {
            const input = document.getElementById('tokenInput').value.trim();
            if (input.startsWith('ghp_')) {
                localStorage.setItem('github_token_gevartplay', input);
                userToken = input;
                unlockAdmin();
            } else alert('–¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –Ω–∞ ghp_');
        }

        function unlockAdmin() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
            loadVideoList(); 
        }

        function logout() { localStorage.removeItem('github_token_gevartplay'); location.reload(); }

        // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –° –û–¢–ß–ï–¢–û–ú ---
        async function uploadImages() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            const logDiv = document.getElementById('uploadLog');
            
            if (files.length === 0) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã!");

            logDiv.classList.remove('hidden');
            logDiv.innerHTML = "<div>–ù–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É...</div>";

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å "–ó–∞–≥—Ä—É–∂–∞—é..."
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                logItem.innerText = `‚è≥ ${file.name}...`;
                logDiv.appendChild(logItem);

                try {
                    const base64 = await readFileAsBase64(file);
                    // –ò–º—è —Å –¥–∞—Ç–æ–π –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                    const safeName = file.name.replace(/\s+/g, '_');
                    const uniqueName = 'img_' + Date.now() + '_' + i + '_' + safeName;

                    const res = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${PHOTO_FOLDER}/${uniqueName}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${userToken}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `Upload photo`, content: base64 })
                    });

                    if (res.ok) {
                        logItem.innerHTML = `‚úÖ ${file.name} - <b>OK</b>`;
                        logItem.classList.add('success');
                    } else {
                        logItem.innerHTML = `‚ùå ${file.name} - –û—à–∏–±–∫–∞ GitHub`;
                        logItem.classList.add('error');
                    }

                } catch (e) {
                    console.error(e);
                    logItem.innerHTML = `‚ùå ${file.name} - –°–±–æ–π`;
                    logItem.classList.add('error');
                }
            }
            
            const doneMsg = document.createElement('div');
            doneMsg.style.marginTop = "10px";
            doneMsg.innerText = "üèÅ –ì–æ—Ç–æ–≤–æ! –û–±–Ω–æ–≤–∏—Ç–µ —Å–∞–π—Ç —á–µ—Ä–µ–∑ 2-3 –º–∏–Ω—É—Ç—ã.";
            doneMsg.style.color = "white";
            logDiv.appendChild(doneMsg);
            
            fileInput.value = ""; 
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // --- –í–ò–î–ï–û ---
        async function loadVideoList() {
            try {
                const r = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${VIDEO_FILE}`, { headers: { 'Authorization': `token ${userToken}`, 'Cache-Control': 'no-cache' } });
                if (r.status === 404) { currentVideos = []; videoFileSha = null; return; }
                const data = await r.json();
                videoFileSha = data.sha;
                currentVideos = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                document.getElementById('videoList').innerHTML = `<p style="color:#00ff00">–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${currentVideos.length} –≤–∏–¥–µ–æ</p>`;
            } catch (e) {}
        }

        async function addVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const category = document.getElementById('videoCategory').value;
            const match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
            if (!match || match[2].length !== 11) return alert("–ü–ª–æ—Ö–∞—è —Å—Å—ã–ª–∫–∞!");
            
            currentVideos.push({ id: match[2], category: category, date: Date.now() });
            await saveVideos();
            document.getElementById('videoUrl').value = "";
            alert("–í–∏–¥–µ–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!");
        }

        async function saveVideos() {
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(currentVideos))));
            const body = { message: "Upd video", content: content };
            if (videoFileSha) body.sha = videoFileSha;
            const r = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${VIDEO_FILE}`, {
                method: 'PUT', headers: { 'Authorization': `token ${userToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            const d = await r.json(); videoFileSha = d.content.sha;
        }
    </script>
</body>
</html>
