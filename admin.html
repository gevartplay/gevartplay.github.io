<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | GevArtPlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: white; font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { font-family: 'Oswald', sans-serif; color: #5b51d8; letter-spacing: 2px; }
        
        .box { background: #111; padding: 30px; border-radius: 10px; border: 1px solid #333; text-align: center; width: 100%; max-width: 500px; margin-bottom: 20px; }
        input, select { width: 90%; padding: 10px; margin-bottom: 20px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }
        
        button { 
            background: #5b51d8; color: white; border: none; padding: 12px 30px; width: 100%;
            font-family: 'Oswald', sans-serif; font-size: 1.2rem; cursor: pointer; transition: 0.3s; border-radius: 5px; margin-bottom: 10px;
        }
        button:hover { background: #fff; color: #000; }
        
        .delete-btn { background: #8b0000; }
        .delete-btn:hover { background: #ff4444; color: white; }

        .video-list { text-align: left; margin-top: 20px; border-top: 1px solid #333; padding-top: 10px; }
        .video-item { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 10px; margin-bottom: 5px; border-radius: 5px; }
        .video-item a { color: #aaa; font-size: 0.9rem; text-decoration: none; max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .video-cat { font-size: 0.7rem; color: #5b51d8; text-transform: uppercase; margin-right: 10px; font-weight: bold; }
        .del-mini { background: #ff4444; color: white; border: none; padding: 5px 10px; font-size: 0.8rem; cursor: pointer; width: auto; }

        #status { margin-top: 15px; font-weight: bold; color: #a3a3a3; white-space: pre-wrap; }
        .hidden { display: none; }
        .logout-link { color: #555; font-size: 12px; cursor: pointer; text-decoration: underline; margin-top: 20px; }
    </style>
</head>
<body>

    <h1>–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h1>

    <div id="loginSection" class="box">
        <h3>–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø</h3>
        <p style="font-size: 12px; color: #aaa; margin-bottom: 10px;">(–¢–æ–∫–µ–Ω –∏–∑ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –Ω–æ–≤—ã–π)</p>
        <input type="password" id="tokenInput" placeholder="ghp_...">
        <button onclick="saveTokenAndLogin()">–í–û–ô–¢–ò</button>
    </div>

    <div id="mainSection" class="hidden">
        
        <div class="box">
            <h3>üì∏ –ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</h3>
            <input type="file" id="fileInput" accept="image/*" multiple>
            <button onclick="uploadImages()">–ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</button>
            
            <details style="margin-top: 10px; cursor: pointer; color: #777;">
                <summary>–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ –∏–º–µ–Ω–∏</summary>
                <input type="text" id="deleteInput" placeholder="–ò–º—è —Ñ–∞–π–ª–∞..." style="margin-top: 10px;">
                <button class="delete-btn" onclick="findAndDeleteImage()">–£–î–ê–õ–ò–¢–¨ –§–û–¢–û</button>
            </details>
        </div>

        <div class="box" style="border-color: #5b51d8;">
            <h3>üé¨ –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ò–î–ï–û</h3>
            
            <p style="font-size: 12px; color: #aaa; text-align: left;">1. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube</p>
            <input type="text" id="videoUrl" placeholder="https://youtu.be/...">
            
            <p style="font-size: 12px; color: #aaa; text-align: left;">2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</p>
            <select id="videoCategory">
                <option value="events">EVENTS (–†–µ–ø–æ—Ä—Ç–∞–∂)</option>
                <option value="fashion">FASHION (–ú–æ–¥–∞)</option>
                <option value="music">MUSIC (–ö–ª–∏–ø—ã)</option>
            </select>

            <button onclick="addVideo()">–î–û–ë–ê–í–ò–¢–¨ –í–ò–î–ï–û</button>

            <div id="videoList" class="video-list">
                <p style="text-align: center; color: #555;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...</p>
            </div>
        </div>

        <p id="status"></p>
        <div class="logout-link" onclick="logout()">–í—ã–π—Ç–∏</div>
    </div>

    <script>
        const USERNAME = 'gevartplay'; 
        const REPO = 'gevartplay.github.io';
        const PHOTO_FOLDER = 'images';
        const VIDEO_FILE = 'videos.json'; // –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ

        let userToken = '';
        let currentVideos = [];
        let videoFileSha = null; // –ù—É–∂–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –Ω–∞ GitHub

        // --- –í–•–û–î ---
        document.addEventListener("DOMContentLoaded", () => {
            const savedToken = localStorage.getItem('github_token_gevartplay');
            if (savedToken) {
                userToken = savedToken;
                unlockAdmin();
            }
        });

        function saveTokenAndLogin() {
            const input = document.getElementById('tokenInput').value.trim();
            if (input.startsWith('ghp_')) {
                localStorage.setItem('github_token_gevartplay', input);
                userToken = input;
                unlockAdmin();
            } else alert('–¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –Ω–∞ ghp_');
        }

        function unlockAdmin() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
            loadVideoList(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥–µ
        }

        function logout() {
            localStorage.removeItem('github_token_gevartplay');
            location.reload();
        }

        // ==========================================
        // –õ–û–ì–ò–ö–ê –í–ò–î–ï–û (YOUTUBE)
        // ==========================================
        
        // 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑ videos.json
        async function loadVideoList() {
            const listContainer = document.getElementById('videoList');
            try {
                const response = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${VIDEO_FILE}`, {
                     headers: { 'Authorization': `token ${userToken}`, 'Cache-Control': 'no-cache' }
                });

                if (response.status === 404) {
                    // –§–∞–π–ª–∞ –µ—â–µ –Ω–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
                    currentVideos = [];
                    videoFileSha = null;
                    renderVideoList();
                    return;
                }

                const data = await response.json();
                videoFileSha = data.sha;
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º Base64 (—Ä—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã —Ç—Ä–µ–±—É—é—Ç decodeURIComponent)
                const content = decodeURIComponent(escape(atob(data.content))); 
                currentVideos = JSON.parse(content);
                renderVideoList();

            } catch (error) {
                console.error(error);
                listContainer.innerHTML = "<p style='color:red'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ</p>";
            }
        }

        // 2. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function renderVideoList() {
            const container = document.getElementById('videoList');
            container.innerHTML = "";
            
            if (currentVideos.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#555;'>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ</p>";
                return;
            }

            currentVideos.forEach((video, index) => {
                const div = document.createElement('div');
                div.className = 'video-item';
                div.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <span class="video-cat">${video.category}</span>
                        <a href="https://youtu.be/${video.id}" target="_blank">youtu.be/${video.id}</a>
                    </div>
                    <button class="del-mini" onclick="deleteVideo(${index})">X</button>
                `;
                container.appendChild(div);
            });
        }

        // 3. –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ
        async function addVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const category = document.getElementById('videoCategory').value;
            const status = document.getElementById('status');

            // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –≤–∏–¥–µ–æ –∏–∑ —Å—Å—ã–ª–∫–∏
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            
            if (!match || match[2].length !== 11) {
                return alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ YouTube!");
            }
            const videoId = match[2];

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
            currentVideos.push({ id: videoId, category: category, date: Date.now() });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ GitHub
            await saveVideosToGitHub(`Add video ${videoId}`);
            document.getElementById('videoUrl').value = "";
        }

        // 4. –£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ
        async function deleteVideo(index) {
            if(!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–∏–¥–µ–æ?")) return;
            currentVideos.splice(index, 1); // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
            await saveVideosToGitHub("Delete video");
        }

        // 5. –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è JSON –Ω–∞ GitHub
        async function saveVideosToGitHub(message) {
            const status = document.getElementById('status');
            status.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–∑—ã –≤–∏–¥–µ–æ...";
            
            // –ö–æ–¥–∏—Ä—É–µ–º –≤ Base64 (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UTF-8)
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(currentVideos))));

            try {
                const body = {
                    message: message,
                    content: content
                };
                if (videoFileSha) body.sha = videoFileSha; // –ï—Å–ª–∏ —Ñ–∞–π–ª –±—ã–ª, —É–∫–∞–∑—ã–≤–∞–µ–º SHA –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

                const response = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${VIDEO_FILE}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${userToken}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    const data = await response.json();
                    videoFileSha = data.content.sha; // –û–±–Ω–æ–≤–ª—è–µ–º SHA
                    status.innerText = "‚úÖ –ë–∞–∑–∞ –≤–∏–¥–µ–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!";
                    status.style.color = "#00ff00";
                    renderVideoList();
                } else {
                    status.innerText = "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∏–¥–µ–æ!";
                    status.style.color = "red";
                }
            } catch (e) {
                console.error(e);
                status.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
            }
        }


        // ==========================================
        // –õ–û–ì–ò–ö–ê –§–û–¢–û (–°–¢–ê–†–ê–Ø)
        // ==========================================
        async function uploadImages() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            const status = document.getElementById('status');

            if (files.length === 0) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã!");

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                status.innerText = `‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ${i + 1}...\n(${file.name})`;
                
                try {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = async function() {
                        const base64 = reader.result.split(',')[1];
                        const safeName = file.name.replace(/\s+/g, '_');
                        const uniqueName = 'img_' + Date.now() + '_' + i + '_' + safeName;

                        await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${PHOTO_FOLDER}/${uniqueName}`, {
                            method: 'PUT',
                            headers: { 'Authorization': `token ${userToken}`, 'Content-Type': 'application/json' },
                            body: JSON.stringify({ message: `Upload photo`, content: base64 })
                        });
                    };
                } catch (e) { console.error(e); }
            }
            // –ñ–¥–µ–º —á—É—Ç—å-—á—É—Ç—å (—Ç–∞–∫ –∫–∞–∫ FileReader –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞, —ç—Ç–æ —É–ø—Ä–æ—â–µ–Ω–∏–µ)
            setTimeout(() => {
                status.innerText = "‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!";
                status.style.color = "#00ff00";
                fileInput.value = ""; 
            }, 2000);
        }

        async function findAndDeleteImage() {
            const namePart = document.getElementById('deleteInput').value.trim();
            if(!namePart) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
            // ... (–ö–æ–¥ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏, —Å–æ–∫—Ä–∞—â–µ–Ω –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞)
            alert("–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ —Å–∞–π—Ç–µ.");
        }
    </script>
</body>
</html>
