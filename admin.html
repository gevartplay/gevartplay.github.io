<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GevArtPlay | ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: white; font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { font-family: 'Oswald', sans-serif; color: #5b51d8; letter-spacing: 2px; }
        
        .upload-box { background: #111; padding: 30px; border-radius: 10px; border: 1px solid #333; text-align: center; margin-bottom: 40px; }
        input[type="file"] { margin-bottom: 20px; display: block; color: #aaa; }
        
        button { 
            background: #5b51d8; color: white; border: none; padding: 12px 30px; 
            font-family: 'Oswald', sans-serif; font-size: 1.2rem; cursor: pointer; transition: 0.3s; 
        }
        button:hover { background: #fff; color: #000; }
        
        #status { margin-top: 15px; font-weight: bold; color: #a3a3a3; }

        /* –°–µ—Ç–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; width: 100%; max-width: 1000px; }
        .img-card { position: relative; border: 1px solid #333; border-radius: 5px; overflow: hidden; }
        .img-card img { width: 100%; height: 150px; object-fit: cover; display: block; }
        .delete-btn { 
            position: absolute; top: 0; right: 0; width: 100%; height: 100%; 
            background: rgba(255, 0, 0, 0.7); color: white; border: none; 
            opacity: 0; cursor: pointer; font-size: 1.5rem; transition: 0.2s; display: flex; justify-content: center; align-items: center;
        }
        .img-card:hover .delete-btn { opacity: 1; }
    </style>
</head>
<body>

    <h1>–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h1>

    <div class="upload-box">
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="uploadImage()">–ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</button>
        <p id="status"></p>
    </div>

    <h2 style="font-family: 'Oswald'; margin-bottom: 20px;">–£–î–ê–õ–ï–ù–ò–ï –§–û–¢–û</h2>
    <div id="gallery" class="gallery-grid">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <script>
        // –í–ê–®–ò –ö–õ–Æ–ß–ò
        const firebaseConfig = {
          apiKey: "AIzaSyAFg-nSFAW-pUw8qgpwoL4FP8wfkGBjuEs",
          authDomain: "gevartplay.firebaseapp.com",
          projectId: "gevartplay",
          storageBucket: "gevartplay.firebasestorage.app",
          messagingSenderId: "986601798069",
          appId: "1:986601798069:web:fcfb03b8b8d67d252c01fc",
          measurementId: "G-6W8EERNJXZ"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        function uploadImage() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) return alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");

            const status = document.getElementById('status');
            status.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞... –ñ–¥–∏—Ç–µ...";
            status.style.color = "#5b51d8";

            // 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ Google Cloud Storage
            const storageRef = storage.ref('portfolio/' + file.name);
            storageRef.put(file).then(snapshot => {
                // 2. –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª
                snapshot.ref.getDownloadURL().then(url => {
                    // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –≤ –ë–∞–∑—É –î–∞–Ω–Ω—ã—Ö
                    db.collection('portfolio').add({
                        url: url,
                        date: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        status.innerText = "–ì–æ—Ç–æ–≤–æ! –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ.";
                        status.style.color = "#00ff00";
                        fileInput.value = ""; // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ
                        loadImages(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                    });
                });
            }).catch(error => {
                console.error(error);
                status.innerText = "–û—à–∏–±–∫–∞: " + error.message;
                status.style.color = "red";
            });
        }

        function loadImages() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É ('desc')
            db.collection('portfolio').orderBy('date', 'desc').get().then(snapshot => {
                if(snapshot.empty) { gallery.innerHTML = "–ù–µ—Ç —Ñ–æ—Ç–æ."; return; }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = 'img-card';
                    div.innerHTML = `
                        <img src="${data.url}">
                        <button class="delete-btn" onclick="deleteImage('${doc.id}')">–£–î–ê–õ–ò–¢–¨ üóëÔ∏è</button>
                    `;
                    gallery.appendChild(div);
                });
            });
        }

        function deleteImage(docId) {
            if(confirm("–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ –∏–∑ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ?")) {
                db.collection('portfolio').doc(docId).delete().then(() => loadImages());
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadImages();
    </script>
</body>
</html>